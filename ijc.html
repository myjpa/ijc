<head>
	<title>interactive javascript console</title>
</head>
<body>
	<form id="form">
		<div>
			<textarea id="history" rows="10" cols="80" style="width:100%;height:80%"></textarea>
		</div>
		<div>
			<input type="text" id="code" style="width:100%"></input>
			<input type="submit" value="eval"> </input>
		</div>
	</form>
</body>
<script type="text/javascript">
	window.ijc = {
		//memeber variables
mixedin : false,
		  history : [],
		  history_cursor : 0,
		  //member functions
		  //mixin, unmixin ijc into global namespace
		  mixin : function(){ 
			  if(!ijc.mixedin){
				  for(key in ijc) {window["__original__"+key]=window[key];window[key] = ijc[key];} 
				  ijc.mixedin = true;
			  }
		  },
unmixin : function(){
			  if(ijc.mixedin){
				  for(key in ijc) {window[key] = window["__original__"+key];} 
				  ijc.mixedin = false;
			  }
		  },
		  //manipulate history
add_history : function(record){
				  if(ijc.history[ijc.history.length-1]!=record) 
					  ijc.history.push(record);
				 ijc.history_cursor = ijc.history.length;
				 
			 },
prev_history : function(){
				   return ijc.history_cursor>0 ? ijc.history[--ijc.history_cursor] : undefined;
			   },
next_history : function(){
				   return ijc.history_cursor<ijc.history.length-1 ? ijc.history[++ijc.history_cursor] : undefined;
			   },

		  //output to stdout
print : function(text) {
			var history=document.getElementById("history");
			history.value+=text;
			history.scrollTop=history.scrollHeight;
		},
puts : function(text) {
		   ijc.print(text+"\n");
	   },
inspect : function(obj) {
			  str = obj;
			  if(typeof(obj)=='object'){
				  if(obj instanceof Array){
					  str = "["+obj+"]"
				  } else if(obj instanceof Object){
					  str = "{";
					  for(key in obj) {
						  str+=key+":"+obj[key]+", ";
					  }
					  str += "}";
				  }
			  }
			  return str;
		  },
clear : function(){
			document.getElementById("history").value = "";
		}
	}
document.getElementById("form").onsubmit = function() {
	var c=document.getElementById("code");
	var r;
	ijc.puts(">> "+c.value);
	ijc.add_history(c.value);
	try{ r=eval(c.value) } catch(err){ r="Error: "+err.description }
	if(r!=undefined) ijc.puts(ijc.inspect(r));
	c.focus();
	c.select();
	return false;
}
document.getElementById("code").onkeydown = function(e){
	elem_code = document.getElementById("code");
	switch(e.keyCode){
		case 38://up arrow
			elem_code.value= ijc.prev_history()||elem_code.value;
			break;
		case 40://down arrow
			elem_code.value= ijc.next_history()||elem_code.value;
			break;
		default:
			return true;
	}
	return false;
}

</script>

