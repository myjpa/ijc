<head>
	<title>interactive javascript console</title>
	<script src="jquery-1.4.2.min.js" type="text/javascript"></script>
</head>
<body>
	<form id="console_ijcwindow">
		<div>
			<textarea id="history_ijcwindow" rows="10" cols="80" style="width:100%;height:80%"></textarea>
		</div>
		<div>
			<input type="text" id="code_ijcwindow" style="width:100%"></input>
			<input type="submit" value="eval"> </input>
		</div>
	</form>
</body>
<script type="text/javascript">
	window.ijc = {
		//memeber variables
console_ijcwindow : document.getElementById("console_ijcwindow"),
					code_ijcwindow : document.getElementById("code_ijcwindow"),
					history_ijcwindow : document.getElementById("history_ijcwindow"),
					mixedin : false,
					history : [],
					history_cursor : 0,
					//member functions
					//mixin, unmixin ijc into global namespace
					mixin : function(){ 
						if(!ijc.mixedin){
							for(key in ijc) {window["__original__"+key]=window[key];window[key] = ijc[key];} 
							ijc.mixedin = true;
						}
					},
unmixin : function(){
			  if(ijc.mixedin){
				  for(key in ijc) {window[key] = window["__original__"+key];} 
				  ijc.mixedin = false;
			  }
		  },
		  //manipulate history
add_history : function(record){
				  if(ijc.history[ijc.history.length-1]!=record) 
					  ijc.history.push(record);
				  ijc.history_cursor = ijc.history.length;

			  },
prev_history : function(){
				   return ijc.history_cursor>0 ? ijc.history[--ijc.history_cursor] : undefined;
			   },
next_history : function(){
				   return ijc.history_cursor<ijc.history.length-1 ? ijc.history[++ijc.history_cursor] : undefined;
			   },

			   //output to stdout
print : function(text) {
			ijc.history_ijcwindow.value+=text;
			ijc.history_ijcwindow.scrollTop=ijc.history_ijcwindow.scrollHeight;
		},
puts : function(text) {
		   ijc.print(text+"\n");
	   },
inspect : function(obj) {
			  str = obj;
			  if(typeof(obj)=='object'){
				  if(obj instanceof Array){
					  str = "["+obj+"]"
				  } else if(obj instanceof Object){
					  str = "{";
					  for(key in obj) {
						  str+=key+":"+obj[key]+", ";
					  }
					  str += "}";
				  }
			  }
			  return str;
		  },
clear : function(){
			history_ijcwindow.value = "";
		},
		//auto completion
hint : function(str) {
		   partial_start = str.search(/[^.]+$/);
		   if(partial_start<0) partial_start = str.length-1;
		   context = str.substr(0,partial_start).replace(/\.$/,'');
		   stub = context.length>0 ? context+"." : "";
		   partial = str.substr(partial_start).replace(/\.$/,'');
		   try{
			   results = [];
			   r = context.length>0 ? eval(context) : window;
			  if(typeof(r)=='object' && r instanceof Object){
				  for(key in r){
					  if(key.indexOf(partial)==0 || partial.length==0)
						  results.push(stub+key);
				  }
				  return results;
			  } else {
				  return undefined;
			  }
		   }catch(err){
			   return undefined;
		   }
	   },


	}
ijc.console_ijcwindow.onsubmit = function() {
	var c=ijc.code_ijcwindow;
	var r;
	ijc.puts(">> "+c.value);
	ijc.add_history(c.value);
	try{ r=eval(c.value) } catch(err){ r="Error: "+err.description }
	if(r!=undefined) ijc.puts(ijc.inspect(r));
	c.focus();
	c.select();
	return false;
}
$('#code_ijcwindow').keydown(function(event){
		switch(event.keyCode){
		case 9: //tab
		if(hints = ijc.hint(ijc.code_ijcwindow.value)){
		if(hints.length==0){
		}else if(hints.length==1){
		ijc.code_ijcwindow.value = hints[0];
		}else{
		puts('(hint)');
		for(i=0;i<hints.length;i++) print(hints[i]+"\t");
		puts('');
		}
		}
		break;
		case 38://up arrow
		ijc.code_ijcwindow.value= ijc.prev_history()||ijc.code_ijcwindow.value;
		break;
		case 40://down arrow
		ijc.code_ijcwindow.value= ijc.next_history()||ijc.code_ijcwindow.value;
		break;
		default:
		return true;
		}
		return false;
		});
//mixin ijc methods into global space
ijc.mixin();
//set focus
ijc.code_ijcwindow.focus();

</script>

